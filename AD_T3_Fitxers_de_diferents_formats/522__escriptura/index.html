<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://asalvadorc.github.io/AD_Tema3/AD_T3_Fitxers_de_diferents_formats/522__escriptura/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>5.2.2 - Escriptura - AD - Accés a Dades</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "5.2.2 - Escriptura";
        var mkdocs_page_input_path = "AD_T3_Fitxers_de_diferents_formats/522__escriptura.md";
        var mkdocs_page_url = "/AD_Tema3/AD_T3_Fitxers_de_diferents_formats/522__escriptura/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../..">
          <img src="../../assets/logocaminas.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Tema 3 Fitxers de diferents formats</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../objectius/">Objectius</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../1_fitxers_binaris_amb_formats_especfics/">1.- Fitxers binaris amb formats específics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../2_accs_directe_a_fitxers/">2.- Accés directe a fitxers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../3_seriaci_dobjectes/">3.- Seriació d'objectes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >4.- Documents XML</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../4_documents_xml/">4 documents xml</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../41__parser_o_analitzador_xml/">4.1 - Parser o analitzador XML</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >4.2 - L'estructura DOM</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../42__lestructura_dom/">42  lestructura dom</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../421_lectura/">4.2.1 Lectura</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../422_escriptura/">4.2.2 Escriptura</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../43__binding/">4.3 - Binding</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >5.- Documents JSON</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../5_documents_json/">5 documents json</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../51__estructura_json/">5.1 - Estructura JSON</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" >5.2 Driver org.json</a>
    <ul class="current">
                <li class="toctree-l3"><a class="reference internal" href="../52_driver_orgjson/">52 driver orgjson</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../521__lectura/">5.2.1 - Lectura</a>
                </li>
                <li class="toctree-l3 current"><a class="reference internal current" href="#">5.2.2 - Escriptura</a>
    <ul class="current">
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >5.3 Driver Moshi</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../53_driver_moshi/">53 driver moshi</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../531_lectura/">5.3.1 Lectura</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../532_escriptura/">5.3.2 Escriptura</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercicis/">Exercicis</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">AD - Accés a Dades</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Tema 3 Fitxers de diferents formats</li>
          <li class="breadcrumb-item">5.- Documents JSON</li>
          <li class="breadcrumb-item">5.2 Driver org.json</li>
      <li class="breadcrumb-item active">5.2.2 - Escriptura</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p>Accés a Dades</p>
<h1 id="522-escriptura">5.2.2 - Escriptura</h1>
<p>Ens falta veure com escriure un document JSON. És molt fàcil anar creant
l'estructura JSON. Només hem de recordar la manera d'afegir al <strong>JSONObject</strong>
i al <strong>JSONArray</strong>.</p>
<ul>
<li><strong>put("nom", element)</strong> per afegir un nou membre a un <strong>JSONObject</strong></li>
<li><strong>put(element)</strong> per afegir un nou element a un <strong>JSONArray</strong></li>
</ul>
<p><em><strong>Nota</strong></em></p>
<p>La major part de drivers utilitzen <strong>add(element)</strong> per a afegir un element a
un JSONArray, en compte de <strong>put</strong>****</p>
<p>Una vegada tinguem l'estructura, podrem passar-la a un <strong>string</strong> amb el
mètode <strong>toString</strong> , i la podrem guardar directament en un fitxer, per
exemple.</p>
<p>Farem més d'un exemple, per poder practicar.</p>
<p>En el primer exemple generarem un JSON a partir de dades definides en el
mateix programa, per mig de vectors. Intentarem generar aquest fitxer JSON:</p>
<p>{ "empresa":<br />
{ "empleat":<br />
[ {<br />
"num": "1",<br />
"nom": "Andreu",<br />
"departament": "10",<br />
"edat": "32",<br />
"sou": "1000.0"<br />
},<br />
{<br />
"num": "2",<br />
"nom": "Bernat",<br />
"departament": "20",<br />
"edat": "28",<br />
"sou": "1200.0"<br />
},<br />
{<br />
"num": "3",<br />
"nom": "Clàudia",<br />
"departament": "10",<br />
"edat": "26",<br />
"sou": "1100.0"<br />
},<br />
{<br />
"num": "4",<br />
"nom": "Damià",<br />
"departament": "10",<br />
"edat": "40",<br />
"sou": "1500.0"<br />
}<br />
]<br />
}<br />
}</p>
<p>Analitzem l'estructura. Tenim un objecte arrel, que consta d'un únic membre,
empresa, que és un objecte. Aquest objecte té un únic membre que és un array.
Cada element de l'array és un objecte, i els seus membres ja són clau-valor.</p>
<p>Copieu el següent codi en el fitxer kotlin
<strong>Exemple_3_5_17_JSONEscriureEmpleats.kt</strong> :</p>
<pre><code>import org.json.JSONObject
import org.json.JSONArray
import java.io.FileWriter

fun main(args: Array&lt;String&gt;) {
    val noms = arrayOf("Andreu", "Bernat", "Clàudia", "Damià")
    val departaments = arrayOf( 10, 20, 10, 10 )
    val edats = arrayOf( 32, 28, 26, 40 )
    val sous = arrayOf( 1000.0, 1200.0, 1100.0, 1500.0)

    val arrel = JSONObject()
    val empresa = JSONObject()
    arrel.put("empresa", empresa)
    val empleats = JSONArray()
    empresa.put("empleat", empleats)

    for (i in 0..3){
        val emp = JSONObject()
        emp.put("num", i + 1)
        emp.put("nom", noms[i])
        emp.put("departament", departaments[i])
        emp.put("edat", edats[i])
        emp.put("sou", sous[i])
        empleats.put(emp)
    }

    val f = FileWriter("Empleats.json")
    f.write(arrel.toString(4))
    f.close()
}
</code></pre>
<p>Hem posat en el moment de passar el JSONObject a String el paràmetre 4, per a
que idente en diferents linies a 4 espais. Com veureu el resultat és quasi
perfecte</p>
<pre><code>{"empresa": {"empleat": [
    {
        "num": 1,
        "sou": 1000,
        "nom": "Andreu",
        "edat": 32,
        "departament": 10
    },
    {
        "num": 2,
        "sou": 1200,
        "nom": "Bernat",
        "edat": 28,
        "departament": 20
    },
    {
        "num": 3,
        "sou": 1100,
        "nom": "Clàudia",
        "edat": 26,
        "departament": 10
    },
    {
        "num": 4,
        "sou": 1500,
        "nom": "Damià",
        "edat": 40,
        "departament": 10
    }
]}}
</code></pre>
<p>Tenim el problema aparent que els membres de cada empleat estan
<strong>desordenats</strong>. No és que haja eixit malament, perquè hem de recordar que un
objecte JSON és un conjunt no ordenat de membres.</p>
<p>Exemple BICICAS</p>
<p>Un altre exemple, el de <strong>Bicicas</strong> , i el que farem per a practicar tant la
lectura com l'escriptura, serà donar-li una altra estructura. Per tant
llegirem l'original, i anirem construint la següent estructura en què està la
informació més resumida:</p>
<p>{ "bicicas":<br />
[ {"num":"01","nom":"UJI - FCHS","llocs":28,"ocupats":11,"lliures":17},<br />
{"num":"02","nom":"ESTACIÓN DE FERROCARRIL Y
AUTOBUSES","llocs":28,"ocupats":8,"lliures":20},<br />
{"num":"03","nom":"PLAZA DE PESCADERÍA","llocs":28,"ocupats":13,"lliures":15},<br />
...<br />
]<br />
}</p>
<p>Tindrem per una banda les estacions d'origen, i per una altra les de destí .</p>
<p>Copieu el següent codi en el fitxer Kotlin
<strong>Exemple_3_5_18_JSONEscriureBicicas.kt</strong> :</p>
<pre><code>import org.json.JSONTokener
import org.json.JSONObject
import org.json.JSONArray
import java.io.FileReader
import java.io.FileWriter

fun main(args: Array&lt;String&gt;) {

    val r_json = FileReader("Bicicas.json")
    val arrel = JSONTokener(r_json).nextValue() as JSONArray
    val estacions = arrel.getJSONObject(0).getJSONArray("ocupacion")

    val destEstacions = JSONArray()

    for (e in estacions){
        e as JSONObject
        val destE = JSONObject();
        destE.put("num", e.get("id"));
        destE.put("nom", e.get("punto"));
        destE.put("llocs", e.get("puestos"));
        destE.put("ocupats", e.get("ocupados"));
        val lliures = e.get("puestos") as Int - e.get("ocupados") as Int
        destE.put("lliures", lliures)
        destEstacions.put(destE)
    }

    val bicicas = JSONObject()
    bicicas.put("bicicas", destEstacions)

    val w_json = FileWriter("Bicicas2.json");
    w_json.write(bicicas.toString(4));
    w_json.close();
}
</code></pre>
<p>El resultat seria aquest (observeu que havíem posat una tabulació de 4):</p>
<pre><code>{"bicicas": [
    {
        "num": "01",
        "ocupats": 23,
        "llocs": 28,
        "nom": "UJI - FCHS",
        "lliures": 5
    },
    {
        "num": "02",
        "ocupats": 0,
        "llocs": 28,
        "nom": "ESTACIÃ³N DE FERROCARRIL Y AUTOBUSES",
        "lliures": 28
    },
...
]}
</code></pre>
<p>Llicenciat sota la  <a href="http://creativecommons.org/licenses/by-nc-sa/2.5/">Llicència Creative Commons Reconeixement NoComercial
CompartirIgual 2.5</a></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../521__lectura/" class="btn btn-neutral float-left" title="5.2.1 - Lectura"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../53_driver_moshi/" class="btn btn-neutral float-right" title="53 driver moshi">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../521__lectura/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../53_driver_moshi/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
