<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://asalvadorc.github.io/AD_Tema3/AD_T3_Fitxers_de_diferents_formats/422_escriptura/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>4.2.2 Escriptura - AD - Accés a Dades</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "4.2.2 Escriptura";
        var mkdocs_page_input_path = "AD_T3_Fitxers_de_diferents_formats/422_escriptura.md";
        var mkdocs_page_url = "/AD_Tema3/AD_T3_Fitxers_de_diferents_formats/422_escriptura/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../..">
          <img src="../../assets/logocaminas.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Tema 3 Fitxers de diferents formats</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../objectius/">Objectius</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../1_fitxers_binaris_amb_formats_especfics/">1.- Fitxers binaris amb formats específics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../2_accs_directe_a_fitxers/">2.- Accés directe a fitxers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../3_seriaci_dobjectes/">3.- Seriació d'objectes</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >4.- Documents XML</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../4_documents_xml/">4 documents xml</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../41__parser_o_analitzador_xml/">4.1 - Parser o analitzador XML</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" >4.2 - L'estructura DOM</a>
    <ul class="current">
                <li class="toctree-l3"><a class="reference internal" href="../42__lestructura_dom/">42  lestructura dom</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../421_lectura/">4.2.1 Lectura</a>
                </li>
                <li class="toctree-l3 current"><a class="reference internal current" href="#">4.2.2 Escriptura</a>
    <ul class="current">
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../43__binding/">4.3 - Binding</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >5.- Documents JSON</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../5_documents_json/">5 documents json</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../51__estructura_json/">5.1 - Estructura JSON</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >5.2 Driver org.json</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../52_driver_orgjson/">52 driver orgjson</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../521__lectura/">5.2.1 - Lectura</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../522__escriptura/">5.2.2 - Escriptura</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >5.3 Driver Moshi</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../53_driver_moshi/">53 driver moshi</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../531_lectura/">5.3.1 Lectura</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../532_escriptura/">5.3.2 Escriptura</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercicis/">Exercicis</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">AD - Accés a Dades</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Tema 3 Fitxers de diferents formats</li>
          <li class="breadcrumb-item">4.- Documents XML</li>
          <li class="breadcrumb-item">4.2 - L'estructura DOM</li>
      <li class="breadcrumb-item active">4.2.2 Escriptura</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p>Accés a Dades</p>
<h1 id="422-escriptura">4.2.2 Escriptura</h1>
<p>Anem ara a crear un nou document XML i a guardar-lo en un fitxer. Utilitzarem
com a exemple <strong>Empleats</strong>. Al final de tot convertirem el fitxer
<strong>Empleats.obj</strong> , generat en la pregunta 3, en el fitxer <strong>Empleats.xml</strong>.</p>
<p>La primera consideració a fer és que partirem d'un document buit. Anirem
construint els elements i posant els atributs, i quan tinguem un element creat
del tot, l'afegirem a l'estructura, és a dir farem que siga el fill d'un que
ja està en l'estructura. Podríem fer-ho també al revés, és a dir, primer
penjar-lo de l'estructura i després anar omplint-lo.</p>
<p>Els principals mètodes per anar construint l'estructura són:</p>
<p><strong>Mètodes de DOCUMENT</strong></p>
<table>
<thead>
<tr>
<th>Valor tornat</th>
<th>Mètode</th>
<th>Descripció</th>
</tr>
</thead>
<tbody>
<tr>
<td>Element</td>
<td><strong>createElement(</strong> String nom<strong>)</strong></td>
<td>crea un nou element amb el nom indicat (s'haurà de penjar en l'estructura)</td>
</tr>
<tr>
<td>Text</td>
<td><strong>createTextNode(</strong> String dades<strong>)</strong></td>
<td>crea un nou element de text (amb contingut)</td>
</tr>
<tr>
<td>Node</td>
<td><strong>appendChild(</strong> Node nou<strong>)</strong></td>
<td>afegeix el node nou, que serà l'arrel</td>
</tr>
</tbody>
</table>
<p><strong>Mètodes de NODE</strong></p>
<table>
<thead>
<tr>
<th>Valor tornat</th>
<th>Mètode</th>
<th>Descripció</th>
</tr>
</thead>
<tbody>
<tr>
<td>Node</td>
<td><strong>appendChild(</strong> Node nou<strong>)</strong></td>
<td>afegeix el node nou com a l'últim fill fins el moment</td>
</tr>
<tr>
<td>void</td>
<td><strong>removeChild(</strong> Node vell<strong>)</strong></td>
<td>lleva el node vell com a fill</td>
</tr>
</tbody>
</table>
<p><strong>Mètodes de ELEMENT</strong></p>
<table>
<thead>
<tr>
<th>Valor tornat</th>
<th>Mètode</th>
<th>Descripció</th>
</tr>
</thead>
<tbody>
<tr>
<td>void</td>
<td><strong>setAttribute(</strong> String nom,String valor<strong>)</strong></td>
<td>afegeix un nou atribut a l'element, amb el nom i valor indicats</td>
</tr>
<tr>
<td>void</td>
<td><strong>removeAttribute(</strong> String nom<strong>)</strong></td>
<td>lleva l'atribut de l'element</td>
</tr>
<tr>
<td>void</td>
<td><strong>setTextContent(</strong> String dades<strong>)</strong></td>
<td>afegeix un fill que serà de text, amb el contingut passat com a paràmetre</td>
</tr>
</tbody>
</table>
<p>Anem a fer directament ja l'exemple dels empleats. Totes les dades seran
elements, excepte el número d'empleat, que farem que siga un atribut d'empleat
per a practicar. A l'element arrel li direm <strong>empleats.</strong> El resultat ha de
ser el fitxer <strong>Empleats.xml</strong>. Copieu el següent codi en el fitxer Kotlin
<strong>Exemple_3_4_4_XMLCrearEmpleats.kt</strong> :</p>
<pre><code>import java.io.ObjectInputStream
import java.io.FileInputStream
import javax.xml.parsers.DocumentBuilderFactory
import java.io.EOFException
import javax.xml.transform.TransformerFactory
import javax.xml.transform.dom.DOMSource
import javax.xml.transform.stream.StreamResult
import javax.xml.transform.OutputKeys

fun main(args: Array&lt;String&gt;) {
    val f = ObjectInputStream(FileInputStream ("Empleats.obj"))

    val doc = DocumentBuilderFactory.newInstance ().newDocumentBuilder().newDocument()
    val arrel = doc.createElement ("empleats")
    doc.appendChild(arrel)

    try {
        while (true) {
            val e = f.readObject () as Empleat
            val emp = doc.createElement ("empleat")
            emp.setAttribute("numero", Integer.toString(e.num))

            val nom = doc.createElement ("nom")
            nom.appendChild(doc.createTextNode(e.nom)) // forma llarga: afegim un fill que és un node de text
            emp.appendChild(nom)

            val dep = doc.createElement("departament")
            dep.setTextContent(e.departament.toString()) // forma curta: amb setTextContent() li posem contingut
            emp.appendChild(dep)

            val edat = doc.createElement("edat")
            edat.setTextContent(e.edat.toString())
            emp.appendChild(edat)

            val sou = doc.createElement("sou");
            sou.setTextContent(e.sou.toString())
            emp.appendChild(sou)

            arrel.appendChild(emp)
        }

    } catch (eof: EOFException) {
        f.close();
    }
    val trans = TransformerFactory.newInstance().newTransformer()

    trans.transform(DOMSource(doc), StreamResult("Empleats.xml"))
}
</code></pre>
<p>En el fitxer XML generat, observareu que no hi ha retorns de carro, tot està
en una mateixa línia. Si voleu veure'l bé, el podeu obrir per exemple amb un
navegador web, que interpreta bé el format XML.</p>
<p>Però també podem crear el fitxer donant-li un aspecte agradable incorporant
aquestes dues línies immediatament abans de crear el fitxer, és a dir,
immediatament abans de la línia 49:</p>
<pre><code>    trans.setOutputProperty(OutputKeys.INDENT, "yes")
    trans.setOutputProperty("{http://xml.apache.org/xslt}indent-amount", "2")
</code></pre>
<p>I el fitxer quedarà així:</p>
<pre><code>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;empleats&gt;
  &lt;empleat numero="1"&gt;
    &lt;nom&gt;Andreu&lt;/nom&gt;
    &lt;departament&gt;10&lt;/departament&gt;
    &lt;edat&gt;32&lt;/edat&gt;
    &lt;sou&gt;1000.0&lt;/sou&gt;
  &lt;/empleat&gt;
  &lt;empleat numero="2"&gt;
    &lt;nom&gt;Bernat&lt;/nom&gt;
    &lt;departament&gt;20&lt;/departament&gt;
    &lt;edat&gt;28&lt;/edat&gt;
    &lt;sou&gt;1200.0&lt;/sou&gt;
  &lt;/empleat&gt;
  &lt;empleat numero="3"&gt;
    &lt;nom&gt;Clàudia&lt;/nom&gt;
    &lt;departament&gt;10&lt;/departament&gt;
    &lt;edat&gt;26&lt;/edat&gt;
    &lt;sou&gt;1100.0&lt;/sou&gt;
  &lt;/empleat&gt;
  &lt;empleat numero="4"&gt;
    &lt;nom&gt;Damià&lt;/nom&gt;
    &lt;departament&gt;10&lt;/departament&gt;
    &lt;edat&gt;40&lt;/edat&gt;
    &lt;sou&gt;1500.0&lt;/sou&gt;
  &lt;/empleat&gt;
&lt;/empleats&gt;
</code></pre>
<p>Llicenciat sota la  <a href="http://creativecommons.org/licenses/by-nc-sa/2.5/">Llicència Creative Commons Reconeixement NoComercial
CompartirIgual 2.5</a></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../421_lectura/" class="btn btn-neutral float-left" title="4.2.1 Lectura"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../43__binding/" class="btn btn-neutral float-right" title="4.3 - Binding">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../421_lectura/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../43__binding/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
