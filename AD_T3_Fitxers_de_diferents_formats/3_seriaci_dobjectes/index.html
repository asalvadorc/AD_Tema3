<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://asalvadorc.github.io/AD_Tema3/AD_T3_Fitxers_de_diferents_formats/3_seriaci_dobjectes/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>3.- Seriació d'objectes - AD - Accés a Dades</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "3.- Seriaci\u00f3 d\u0027objectes";
        var mkdocs_page_input_path = "AD_T3_Fitxers_de_diferents_formats/3_seriaci_dobjectes.md";
        var mkdocs_page_url = "/AD_Tema3/AD_T3_Fitxers_de_diferents_formats/3_seriaci_dobjectes/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../..">
          <img src="../../assets/logocaminas.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Tema 3 Fitxers de diferents formats</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../objectius/">Objectius</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../1_fitxers_binaris_amb_formats_especfics/">1.- Fitxers binaris amb formats específics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../2_accs_directe_a_fitxers/">2.- Accés directe a fitxers</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">3.- Seriació d'objectes</a>
    <ul class="current">
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >4.- Documents XML</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../4_documents_xml/">4 documents xml</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../41__parser_o_analitzador_xml/">4.1 - Parser o analitzador XML</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >4.2 - L'estructura DOM</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../42__lestructura_dom/">42  lestructura dom</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../421_lectura/">4.2.1 Lectura</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../422_escriptura/">4.2.2 Escriptura</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../43__binding/">4.3 - Binding</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >5.- Documents JSON</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../5_documents_json/">5 documents json</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../51__estructura_json/">5.1 - Estructura JSON</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >5.2 Driver org.json</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../52_driver_orgjson/">52 driver orgjson</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../521__lectura/">5.2.1 - Lectura</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../522__escriptura/">5.2.2 - Escriptura</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >5.3 Driver Moshi</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../53_driver_moshi/">53 driver moshi</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../531_lectura/">5.3.1 Lectura</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../532_escriptura/">5.3.2 Escriptura</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercicis/">Exercicis</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">AD - Accés a Dades</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Tema 3 Fitxers de diferents formats</li>
      <li class="breadcrumb-item active">3.- Seriació d'objectes</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p>Accés a Dades</p>
<h1 id="3-seriacio-dobjectes">3.- Seriació d'objectes</h1>
<p>Seriació d'objectes</p>
<p>La tècnica de la <strong>seriació</strong> és segurament la més senzilla de totes, però
també a la vegada la més problemàtica. Java, i per tant també Kotlin, disposa
d’un sistema genèric de seriació de qualsevol objecte, un sistema <strong>recursiu</strong>
que es repeteix per cada objecte contingut a la instància que s’està seriant.
Aquest procés para en arribar als tipus primitius, els quals es guarden com
una sèrie de bytes. A banda dels tipus primitius, Java serialitza també molta
informació addicional o metadades específiques de cada classe (el nom de les
classe, els noms dels atributs i molta més informació addicional). Gràcies a
les metadades es fa possible automatitzar la seriació de forma genèrica <strong>amb
garanties de recuperar un objecte tal com es va guardar</strong>.</p>
<p>Lamentablement, <strong>aquest és un procediment específic de Java</strong>. És a dir, no
és possible recuperar els objectes seriats des de Java utilitzant un altre
llenguatge. D’altra banda, el fet de guardar metadades pot arribar a comportar
també problemes, encara que utilitzem sempre el llenguatge Java. La
modificació d’una classe pot fer variar les seues metadades. Aquestes
variacions poden donar problemes de recuperació d’instàncies que hagen estat
guardades amb algunes versions anteriors a la modificació, impedint que
l’objecte puga ser recuperat.</p>
<p>Aquestes consideracions fa que no siga pràctica aquesta tècnica per guardar
objectes de forma més o menys permanent. En canvi, la seua senzillesa la fa
una perfecta candidata per a l’emmagatzematge temporal, per exemple dins de la
mateixa sessió.</p>
<p>Per a que un objecte puga ser seriat cal que la seua classe i tot el seu
contingut implementen la interfície <strong>Serializable</strong>. Es tracta d’una
interfície sense mètodes, perquè l’únic objectiu de la interfície és actuar de
marcador per indicar a la màquina virtual quines classes es poden seriar i
quines no.</p>
<p>Totes les classes equivalents als tipus bàsics ja implementen Serializable.
També implementen aquesta interfície la classe String i tots els contenidors i
els objectes Array. La seriació de col·leccions depèn en últim terme dels
elements continguts. Si aquestos són seriables, la col·lecció també ho serà.</p>
<p>En cas que la classe de l’objecte que s’intente seriar, o les d’algun dels
objectes que continga, no implementaren la interfície Serializable, es
llançaria una excepció de tipus <strong>NotSerializableException</strong> , impedint
l’emmagatzematge.</p>
<p>Els Streams <strong>ObjectInputStream</strong> i <strong>ObjectOutputStream</strong> són decoradors que
afegeixen a qualsevol altre Stream la capacitat de seriar qualsevol objecte
Serializable. El stream d'eixida disposarà del mètode <strong>writeObject</strong>. i el
stream d’entrada, el mètode de lectura <strong>readObject</strong>.</p>
<p>El mètode readObject només permet recuperar instàncies que siguen de la
mateixa classe que la que es va guardar. En cas contrari, es llançaria una
excepció de tipus <strong>ClassCastExeception</strong>. A més, cal que l’aplicació dispose
del codi compilat de la classe; si no fóra així, l’excepció llançada seria
<strong>ClassNotFoundException</strong>.</p>
<p>Exemple</p>
<p>Ens recolzarem en un exemple utilitzat en els anteriors punts, en els
empleats. Ara anem a suposar que els empleats són objectes, i intentarem
guardar aquestos objectes en un fitxer amb una seriació.</p>
<p>El primer pas serà construir la classe <strong>Empleat</strong> , que contindrà la mateixa
informació que en els altres apartats: número d'empleat, nom, departament,
edat i sou.</p>
<pre><code>package exemples

import java.io.Serializable

class Empleat (var num: Int, var nom: String, var departament: Int, var edat: Int, var sou: Double): Serializable
</code></pre>
<p>Anem a intentar construir el fitxer de dades amb els objectes guardats. El
flux de dades serà un <strong>ObjectOutputStream</strong> per a poder escriure
(<strong>writeObject</strong>). I observeu com s'ha de recolzar en un OutputStream, que en
aquest cas serà d'un fitxer, és a dir un <strong>FileOutputStream</strong>. A cada iteració
del bucle senzillament construirem un objecte de la classe <strong>Empleat</strong> i
l'escriurem al fitxer. Copieu el següent codi en un fitxer Kotlin anomenat
<strong>Exemple_3_3_1_GuardarObjectes.kt</strong></p>
<pre><code>import java.io.ObjectOutputStream
import java.io.FileOutputStream

fun main(args: Array&lt;String&gt;) {
    val f = ObjectOutputStream(FileOutputStream("Empleats.obj"))

    val noms = arrayOf("Andreu", "Bernat", "Clàudia", "Damià")
    val departaments = arrayOf(10, 20, 10, 10)
    val edats = arrayOf(32, 28, 26, 40)
    val sous = arrayOf(1000.0, 1200.0, 1100.0, 1500.0)

    for (i in 0..3){
        val e = Empleat (i + 1, noms[i], departaments[i], edats[i], sous[i])
        f.writeObject(e)
    }

    f.close();
}
</code></pre>
<p><strong>Nota</strong></p>
<p>El fitxer creat, <strong>Empleats.obj</strong> , evidentment no és de text. Tanmateix si
l'obrim amb un editor de text podrem veure alguna cosa.</p>
<p><img alt="" src="../T3_3_1.png" /></p>
<ul>
<li>La primera qüestió és que es guarda el nom de la classe amb el nom del paquet davant. <strong>exemples.Empleat</strong> és realment el nom de la classe creada.</li>
<li>Es guarden també els noms dels camps. Tot això són les metadades que havíem comentat, i que permeten la recuperació posterior dels objectes guardats</li>
<li>I després ja podem veure la informació guardada, on identifiquem els noms dels empleats</li>
</ul>
<p>Per a llegir el fitxer creat, <strong>Empleats.obj</strong> , utilitzarem el
<strong>ObjectInputStream</strong> per a poder fer <strong>readObject</strong>. S'ha de basar en un
InputStream, que en aquest cas serà un <strong>FileInputStream</strong>.</p>
<p>Lamentablement el mètode <strong>available()</strong> no funcionarà correctament, i no ens
dirà realment els bytes que queden per llegir.</p>
<p>El tractament de final de fitxer el farem capturant l'excepció (l'error)
d'haver arribat al final i intentat llegir encara: <strong>EOFException</strong>. La raó és
que <strong>readObject</strong> no torna null, a no ser que s'haja introduït aquest valor.
Per tant muntem un bucle infinit, però capturant amb <strong>try ... catch</strong>
l'error, que és quan tancarem el Stream. Copieu el següent codi a un fitxer
Kotlin anomenat <strong>Exemple_3_3_2_LlegirObjectes.kt</strong></p>
<pre><code>package exemples

import java.io.ObjectInputStream
import java.io.FileInputStream
import java.io.EOFException

fun main(args: Array&lt;String&gt;) {
    val f = ObjectInputStream(FileInputStream("Empleats.obj"))

    try {
        while (true) {
            val e = f.readObject() as Empleat
            println("Número: " + e.num)
            println("Nom: " + e.nom)
            println("Departament: " + e.departament)
            println("Edat: " + e.edat)
            println("Sou: " + e.sou)
            println();
        }
    } catch (eof: EOFException) {
        f.close()
    }
}
</code></pre>
<p><strong><em>Nota</em></strong></p>
<p>En realitat, en el fitxer es guarda, a més del nom del paquet i el nom de la
classe, l'identificador de la classe: el <strong>serialVersionUID</strong> , per a poder
identificar unívocament la classe. Això ens pot donar problemes si intentem
compartir la informació entre nosaltres, ja que perfectament ens pot generar
UID diferents. Per a evitar-lo podríem definir nosaltres aquest
<strong>serialVersionUID</strong> , i aleshores no hi haurà problemes per a compartir. Fins
i tot serviria per a poder compartir el fitxer d'objectes entre <strong>Kotlin</strong> i
<strong>Java</strong></p>
<pre><code>package exemples

import java.io.Serializable

class Empleat (var num: Int,var nom: String,var departament: Int,var edat: Int,var sou: Double): Serializable {
    companion object {
        private const val serialVersionUID: Long = 1
    }
}
</code></pre>
<p>Si fem aquest canvi en la classe Empleat haurem de tornar a generar el fitxer
(<strong>Exemple_3_3_1_GuardarObjectes.kt</strong>) abans de poder consultar-lo
(<strong>Exemple_3_3_2_LlegirObjectes.kt</strong>), perquè a tots els efectes seria una
classe nova.</p>
<p>Llicenciat sota la  <a href="http://creativecommons.org/licenses/by-nc-sa/2.5/">Llicència Creative Commons Reconeixement NoComercial
CompartirIgual 2.5</a></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../2_accs_directe_a_fitxers/" class="btn btn-neutral float-left" title="2.- Accés directe a fitxers"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../4_documents_xml/" class="btn btn-neutral float-right" title="4 documents xml">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../2_accs_directe_a_fitxers/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../4_documents_xml/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
