<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://asalvadorc.github.io/AD_Tema3/AD_T3_Fitxers_de_diferents_formats/531_lectura/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>5.3.1 Lectura - AD - Accés a Dades</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "5.3.1 Lectura";
        var mkdocs_page_input_path = "AD_T3_Fitxers_de_diferents_formats/531_lectura.md";
        var mkdocs_page_url = "/AD_Tema3/AD_T3_Fitxers_de_diferents_formats/531_lectura/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../..">
          <img src="../../assets/logocaminas.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Tema 3 Fitxers de diferents formats</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../objectius/">Objectius</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../1_fitxers_binaris_amb_formats_especfics/">1.- Fitxers binaris amb formats específics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../2_accs_directe_a_fitxers/">2.- Accés directe a fitxers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../3_seriaci_dobjectes/">3.- Seriació d'objectes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >4.- Documents XML</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../4_documents_xml/">4 documents xml</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../41__parser_o_analitzador_xml/">4.1 - Parser o analitzador XML</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >4.2 - L'estructura DOM</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../42__lestructura_dom/">42  lestructura dom</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../421_lectura/">4.2.1 Lectura</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../422_escriptura/">4.2.2 Escriptura</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../43__binding/">4.3 - Binding</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >5.- Documents JSON</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../5_documents_json/">5 documents json</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../51__estructura_json/">5.1 - Estructura JSON</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >5.2 Driver org.json</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../52_driver_orgjson/">52 driver orgjson</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../521__lectura/">5.2.1 - Lectura</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../522__escriptura/">5.2.2 - Escriptura</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" >5.3 Driver Moshi</a>
    <ul class="current">
                <li class="toctree-l3"><a class="reference internal" href="../53_driver_moshi/">53 driver moshi</a>
                </li>
                <li class="toctree-l3 current"><a class="reference internal current" href="#">5.3.1 Lectura</a>
    <ul class="current">
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../532_escriptura/">5.3.2 Escriptura</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../exercicis/">Exercicis</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">AD - Accés a Dades</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Tema 3 Fitxers de diferents formats</li>
          <li class="breadcrumb-item">5.- Documents JSON</li>
          <li class="breadcrumb-item">5.3 Driver Moshi</li>
      <li class="breadcrumb-item active">5.3.1 Lectura</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p>Accés a Dades</p>
<h1 id="531-lectura">5.3.1 Lectura</h1>
<p>Com comentàvem en la pregunta anterior, la llibreria Moshi permet passar d'un
document JSON directament a objectes Java o Kotlin.</p>
<p>Ho mostrarem en dos exemples:</p>
<ul>
<li>Primer per a poder llegir Empresa.json, en què l'element arrel és un objecte Json.</li>
<li>Després per a llegir Bicicas,json, en què l'element arrel és un array Json, cosa que ens complica un poc la lectura</li>
</ul>
<p>Cas 1: l'arrel és un objecte</p>
<p>Tant en un com en l'altre primer haurem de crear les classes Java o Kotlin on
anirà la lectura del fitxer. Aquestes classes hauran de tenir la mateixa
estructura que en JSON, però adaptades a Java o Kotlin.</p>
<p>Anem per tant a analitzar <strong>Empresa.json</strong> , que ja el teníem creat i tenia
aquesta estructura:</p>
<p>{ "empresa" :<br />
{ "empleats":<br />
[<br />
{ "num":1, "nom": "Andreu", "departament": 10, "edat": 32, "sou": 1000.0} ,<br />
{ "num":2, "nom": "Bernat", "departament": 20, "edat": 28, "sou": 1200.0} ,<br />
{ "num":3, "nom": "Clàudia", "departament": 10, "edat": 26, "sou": 1100.0} ,<br />
{ "num":4, "nom": "Damià", "departament": 10, "edat": 40, "sou": 1500.0}<br />
]<br />
}<br />
}</p>
<p>També teníem creada la classe Empleat, des de la pregunta 3 d'aquest tema, i
tenia aquesta estructura. <strong>Empleat.kt</strong> :</p>
<pre><code>class Empleat (var num: Int, var nom: String, var departament: Int, var edat: Int, var sou: Double)
</code></pre>
<p>L'havíem fet <strong>Serializable</strong> , però això no importa en aquest exemple. El
podem deixar tal qual estava.</p>
<p>L'estuctura del fitxer JSON, ens marca que l'arrel és un <strong>objecte</strong> que té un
únic membre que es diu <strong>empresa</strong> , que és un <strong>objecte</strong> que té un únic
membre anomenat <strong>empleats</strong> , que és un <strong>array</strong> d'objectes (que
coincideixen ja amb la classe <strong>Empleat</strong>).</p>
<p>Per tant ens hem de construir una <strong>classe</strong> que que tinga una propietat
anomenada <strong>empleats</strong> , que siga un conjunt de <strong>Empleat</strong>. Ens vindrà bé un
<strong>List</strong>. Com que la utilitzarem en més d'un exemple, la guardem en el fitxer
de classe <strong>Empleats.kt</strong> ;</p>
<pre><code>class Empleats(val empleats: List&lt;Empleat&gt; = listOf&lt;Empleat&gt;())
</code></pre>
<p>I a partir d'aquesta hem de construir una altra classe que tinga una única
propietat anomenada <strong>empresa</strong> que siga de tipus <strong>Empleats</strong>. Com que la
utilitzarem en més d'un exemple, la guardem en el fitxer de classe
<strong>Empresa.kt</strong></p>
<pre><code>class Empresa(val empresa: Empleats)
</code></pre>
<p>La lectura del fitxer la fem a partir d'un objecte <strong>Moshi</strong> al qual per mig
del mètode <strong>adapter</strong> definim quina classe volem llegir. Una vegada llegit ja
podem utilitzar els objectes Java o Kotlin.</p>
<p>Copieu el següent codi en el fitxer Kotlin
<strong>Exemple_3_5_21_MOSHIAnalitzarEmpresa.kt</strong> :</p>
<pre><code>package exemples

import com.squareup.moshi.*
import java.io.File

fun main (args: Array&lt;String&gt;){
    val json = File("Empresa.json").readText()

    val moshi = Moshi.Builder().build()
    val adapter = moshi.adapter(Empresa::class.java)
    val empresa = adapter.fromJson(json)

    val llEmpleats= empresa!!.empresa.empleats
    println("Hi ha " + llEmpleats.size + " empleats:")
    for (e in llEmpleats)
        println(e.nom + " (" + e.sou  +")")
}
</code></pre>
<p>Cas 2: l'arrel és un array</p>
<p>En cas que l'arrel del fitxer JSON siga un array, se'ns complica un poc,
perquè en el moment de definir quina classe volem llegir, no és en realitat
una classe, sinó un col·lecció (un List havíem vist que és el que
utilitzàvem).</p>
<p>Moshi utilitza una tècnica per a poder fer la lectura de l'array, que
consisteix a crear-se un tipus de dades que seria la concatenació d'un List i
de la classe de la qual volem l'array. Ho veurem molt millor en l'exemple.</p>
<p>L'exemple serà per a llegir el fitxer Bicicas.json, que recordem que començava
per un array:</p>
<p>[<br />
{"ocupacion":<br />
[ {"id":"01","punto":"UJI -
FCHS","puestos":28,"ocupados":11,"latitud":"39.99533","longitud":"-0.06999",<br />
"porcentajeAltaOcupacion":"80","porcentajeBajaOcupacion":"20"},<br />
{"id":"02","punto":"ESTACIÓN DE FERROCARRIL Y
AUTOBUSES","puestos":28,"ocupados":8,"latitud":"39.98765",<br />
"longitud":"-0.05281","porcentajeAltaOcupacion":"80","porcentajeBajaOcupacion":"20"},<br />
{"id":"03","punto":"PLAZA DE
PESCADERÍA","puestos":28,"ocupados":13,"latitud":"39.98580","longitud":"-0.03798",<br />
"porcentajeAltaOcupacion":"80","porcentajeBajaOcupacion":"20"},<br />
...<br />
]<br />
}<br />
]</p>
<p>Era un array d'un únic element , però en definitiva un array. Només ens
interessa el primer element, que serà un objecte amb un únic membre anomenat
<strong>ocupacion</strong> , que és un array on cada element és un objecte corresponent a
una estació, amb les seues característiques com a parelles clau-valor.</p>
<p>Definim per tant la classe <strong>Estacio.kt</strong> :</p>
<pre><code>class Estacio(
    val id: Long, val punto: String, val puestos: Int,
    val ocupados: Int, val latitud: Double, val longitud: Double,
    val porcentajeAltaOcupacion: Int, val porcentajeBajaOcupacion: Int
)
</code></pre>
<p>I la classe <strong>Estacions.kt</strong> ****:</p>
<pre><code>class Estacions(val ocupacion: List&lt;Estacio&gt; = listOf&lt;Estacio&gt;())
</code></pre>
<p>Copieu el següent codi en un fitxer Kotlin anomenat
<strong>Exemple_3_5_22_MOSHIAnalitzarBicicas.kt</strong> :</p>
<pre><code>package exemples

import com.squareup.moshi.*
import java.io.File

fun main(args: Array&lt;String&gt;) {
    val json = File("Bicicas.json").readText()

    val moshi = Moshi.Builder().build()
    val llistaTipus = Types.newParameterizedType(List::class.java, Estacions::class.java)
    val adapter: JsonAdapter&lt;List&lt;Estacions&gt;&gt; = moshi.adapter(llistaTipus)
    val bicicas = adapter.fromJson(json)

    val estacions = bicicas!!.get(0).ocupacion
    println("Hi ha " + estacions.size + " estacions:")
    for (e in estacions)
        println("" + e.id + ": " + e.punto + " (" + e.ocupados + "/" + e.puestos + ")")
}
</code></pre>
<p>Llicenciat sota la  <a href="http://creativecommons.org/licenses/by-nc-sa/2.5/">Llicència Creative Commons Reconeixement NoComercial
CompartirIgual 2.5</a></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../53_driver_moshi/" class="btn btn-neutral float-left" title="53 driver moshi"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../532_escriptura/" class="btn btn-neutral float-right" title="5.3.2 Escriptura">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../53_driver_moshi/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../532_escriptura/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
